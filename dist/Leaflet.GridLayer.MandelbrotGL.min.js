L.GridLayer.MandelbrotGL=L.GridLayer.extend({_vertexShader:"attribute vec2 aVertexPosition;attribute highp vec3 aPlotPosition;varying highp vec3 b;void main(){gl_Position=vec4(aVertexPosition,1,1);b=aPlotPosition;}",_fragMandelbrot:"#version 100\nprecision highp float;varying highp vec3 b;int fractal(){float c,d,e,f,g,h;c=b.x;d=b.y;e=b.z;f=0.;g=0.;h=0.;int i,j,k;i=0;j=100+int(e)*50;k=0;for(int i=1;i<200;i++){h=f*f-g*g+float(c);g=2.*f*g+float(d);f=h;if(k==0&&f*f+g*g>1e2){k=i;break;}}return k;}",_fragHueramp:"void main(){int b,g;b=0;float c,d,e,f,h,i,j,k;b=fractal();if(b!=0){c=float(b)/2e2;d=.6;e=1.;f=c*6.;g=int(mod(float(f),6.));h=fract(f);i=e*(1.-d);j=e*(1.-h*d);k=e*(1.-(1.-h)*d);if(g==0)gl_FragColor=vec4(e,k,i,1);else if(g==1)gl_FragColor=vec4(j,e,i,1);else if(g==2)gl_FragColor=vec4(i,e,k,1);else if(g==3)gl_FragColor=vec4(i,j,e,1);else if(g==4)gl_FragColor=vec4(k,i,e,1);else if(g==5)gl_FragColor=vec4(e,i,j,1);}else gl_FragColor=vec4(0,0,0,1);}",_fragBlueramp:"void main(){int a=0;float b,c;a=fractal();if(a!=0){b=float(a)/1e2;c=b/2.;gl_FragColor=vec4(c,c,b,1);}else gl_FragColor=vec4(0,0,0,1);}",_fragZebra:"void main(){int c=0;c=fractal();if(c*2147483648/1073741824!=0)gl_FragColor=vec4(1);else gl_FragColor=vec4(0,0,0,1);}",_fragHcl:"mat4 a=mat4(3.2404542,-1.5371385,-.4985314,0,-.969266,1.8760108,.041556,0,.0556434,-.2040259,1.0572252,0,0,0,0,1);float lab2xyz(float b){if(b>.00080817591)return pow(b,3.);else return (b-.0005387931)/.030418113;}vec4 hcl2rgb(vec4 b){float c,d,e,f,g,h,i,j,k;c=b[0];d=b[1];e=b[2];f=b[3];c*=2.*3.141592653589793;g=cos(c)*d;h=sin(c)*d;i=(e+.0625)/.453126;j=i+g/1.953125;k=i-h/.78125;j=lab2xyz(j)*.95047;i=lab2xyz(i)*1.;k=lab2xyz(k)*1.08883;return vec4(j,i,k,f)*a;}",_fragHclHueramp:"void main(){int b=0;b=fractal();if(b>0){float c,d,e;c=float(b)/25.;d=.2+float(b)/1e3;e=clamp(float(b)/3e2,.3,.7);gl_FragColor=hcl2rgb(vec4(c,e,d,1));}else gl_FragColor=vec4(0,0,0,1);}",_fragHclBlueramp:"void main(){int b=0;b=fractal();if(b>0){float c,d,e;c=.7+float(b)/2e3;d=.15+float(b)/4e2;e=float(b)/2e2;gl_FragColor=hcl2rgb(vec4(c,e,d,1));}else gl_FragColor=vec4(0,0,0,1);}",options:{maxZoom:22,colorRamp:"hue",fractal:"mandelbrot"},initialize:function(e){e=L.setOptions(this,e),this._renderer=L.DomUtil.create("canvas"),this._renderer.width=this._renderer.height=this.options.tileSize;var r=this._gl=this._renderer.getContext("experimental-webgl");r.viewportWidth=this.options.tileSize,r.viewportHeight=this.options.tileSize,this._loadGLProgram(),this._vertexBuffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,this._vertexBuffer);var t=[1,1,-1,1,1,-1,-1,-1];r.bufferData(r.ARRAY_BUFFER,new Float32Array(t),r.STATIC_DRAW),this._vertexBuffer.itemSize=2,this._vertexBuffer.numItems=4,r.bindBuffer(r.ARRAY_BUFFER,this._vertexBuffer),r.vertexAttribPointer(this._aVertexPosition,this._vertexBuffer.itemSize,r.FLOAT,!1,0,0)},_loadGLProgram:function(e,r){var t=this._gl,a=this._fragHueramp;"blue"==this.options.colorRamp?a=this._fragBlueramp:"zebra"==this.options.colorRamp?a=this._fragZebra:"hclhue"==this.options.colorRamp?a=this._fragHcl+this._fragHclHueramp:"hclblue"==this.options.colorRamp&&(a=this._fragHcl+this._fragHclBlueramp);var i=this._fragMandelbrot,o=t.createProgram(),l=t.createShader(t.VERTEX_SHADER),n=t.createShader(t.FRAGMENT_SHADER);return t.shaderSource(l,this._vertexShader),t.shaderSource(n,i+a),t.compileShader(l),t.compileShader(n),t.getShaderParameter(l,t.COMPILE_STATUS)?t.getShaderParameter(n,t.COMPILE_STATUS)?(t.attachShader(o,l),t.attachShader(o,n),t.linkProgram(o),t.useProgram(o),this._aVertexPosition=t.getAttribLocation(o,"aVertexPosition"),t.enableVertexAttribArray(this._aVertexPosition),this._aPlotPosition=t.getAttribLocation(o,"aPlotPosition"),void t.enableVertexAttribArray(this._aPlotPosition)):(console.error(t.getShaderInfoLog(n)),null):(console.error(t.getShaderInfoLog(l)),null)},_render:function(e){var r,t=this._gl;corners=[];var a=[[.5,.5],[-.5,.5],[.5,-.5],[-.5,-.5]],i=Math.pow(2,e.z),o=(e.x+.5)/i,l=(e.y+.5)/i;for(r in a)x=a[r][0],y=a[r][1],corners.push(x/i+o),corners.push(y/i-l),corners.push(i);var n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array(corners),t.STATIC_DRAW),t.vertexAttribPointer(this._aPlotPosition,3,t.FLOAT,!1,0,0),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.deleteBuffer(n)},createTile:function(e,r){var t=L.DomUtil.create("canvas","leaflet-tile");t.width=t.height=this.options.tileSize,t.onselectstart=t.onmousemove=L.Util.falseFn;var a=t.getContext("2d");return this._render(e),a.drawImage(this._renderer,0,0),L.DomUtil.addClass(t,"leaflet-tile-loaded"),t},setColorRamp:function(e){this.options.colorRamp=e,this._loadGLProgram(),this.redraw()}}),L.gridLayer.mandelbrotGL=function(e){return new L.GridLayer.MandelbrotGL(e)};
//# sourceMappingURL=Leaflet.GridLayer.MandelbrotGL.min.js.map
